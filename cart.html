<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TikSepet | Sepet</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="icon" type="image/x-icon" href="assets/favicon/favicon.ico" />
  </head>
  <body>
    <div id="loader">YÃ¼kleniyor...</div>

    <!-- Ãœst navigasyon -->
    <header>
      <nav class="navbar">
        <a href="index.html" class="logo">
          <img
            src="assets/images/logos/logo_light.png"
            alt="TikSepet"
            id="site-logo"
          />
        </a>

        <!-- MenÃ¼ baÄŸlantÄ±larÄ± -->
        <ul class="nav-links" id="navLinks">
          <li><a href="index.html">Anasayfa</a></li>
          <li><a href="products.html">ÃœrÃ¼nler</a></li>
          <li>
            <a href="cart.html">
              Sepet <span id="cart-count" class="cart-count">0</span>
            </a>
          </li>
          <li><a href="profile.html">Profil</a></li>
          <li><a href="admin.html">Admin</a></li>
        </ul>

        <!-- Tema ve hamburger birlikte -->
        <div class="nav-right">
          <button class="theme-toggle" onclick="toggleTheme()">ðŸŒ“</button>
          <div class="nav-toggle" onclick="toggleMenu()">
            <span></span><span></span><span></span>
          </div>
        </div>
      </nav>
    </header>

    <main>
      <div class="cart-container">
        <h1 class="cart-title">Sepetim</h1>
        <div id="cart-items">
          <!-- ÃœrÃ¼nler burada gÃ¶sterilecek -->
        </div>
        <div class="cart-total" id="cart-total">Toplam: â‚º0,00</div>
        <div class="cart-empty" id="cart-empty" style="display: none">
          Sepetiniz boÅŸ.
        </div>

        <!-- Ã–deme ve alÄ±ÅŸveriÅŸe devam butonlarÄ± -->
        <div class="cart-actions">
          <button id="checkout-btn" class="checkout-btn">Ã–demeye GeÃ§</button>
          <a href="products.html" class="continue-shopping"
            >AlÄ±ÅŸveriÅŸe Devam Et</a
          >
        </div>
      </div>
    </main>

    <footer>
      <div class="footer-content">
        <img
          src="assets/images/logos/logo_light.png"
          alt="TikSepet Logo"
          id="footer-logo"
          class="footer-logo"
        />
        <p>&copy; 2025 TikSepet E-Ticaret Sitesi created by Hakan Onay</p>
      </div>
    </footer>

    <script>
      // Tema logosunu gÃ¼ncelle
      function updateFooterLogo() {
        const footerLogo = document.getElementById("footer-logo");
        footerLogo.src = document.body.classList.contains("dark")
          ? "assets/images/logos/logo_dark.png"
          : "assets/images/logos/logo_light.png";
      }

      function toggleMenu() {
        document.getElementById("navLinks").classList.toggle("active");
      }

      // Tema deÄŸiÅŸtirme
      function toggleTheme() {
        document.body.classList.toggle("dark");
        const theme = document.body.classList.contains("dark")
          ? "dark"
          : "light";
        localStorage.setItem("theme", theme);
        updateFooterLogo();
        updateLogo(theme);
      }

      // Logo gÃ¼ncelle
      function updateLogo(theme) {
        const logo = document.getElementById("site-logo");
        logo.src =
          theme === "dark"
            ? "assets/images/logos/logo_dark.png"
            : "assets/images/logos/logo_light.png";
      }

      // Sepet rozeti (NAV)
      function updateCartCount() {
        const cart = JSON.parse(localStorage.getItem("cart") || "[]");
        const cartCountElement = document.getElementById("cart-count");
        if (cartCountElement) {
          cartCountElement.textContent = cart.length;
        }
      }

      // CanlÄ± rozet: localStorage deÄŸiÅŸimini aynÄ± sekmede de yakalar
      (function () {
        const _setItem = localStorage.setItem;
        const _removeItem = localStorage.removeItem;

        localStorage.setItem = function (key, value) {
          const oldVal = localStorage.getItem(key);
          _setItem.apply(this, arguments);
          if (key === "cart" && oldVal !== value) {
            window.dispatchEvent(new Event("cart-changed"));
          }
        };

        localStorage.removeItem = function (key) {
          _removeItem.apply(this, arguments);
          if (key === "cart") {
            window.dispatchEvent(new Event("cart-changed"));
          }
        };

        // FarklÄ± sekmede deÄŸiÅŸirse
        window.addEventListener("storage", (e) => {
          if (e.key === "cart") window.dispatchEvent(new Event("cart-changed"));
        });
      })();

      // Toplam tutarÄ± hesapla ve UI'yi gÃ¼ncelle
      function updateCartTotal() {
        let total = 0;
        const cartItems = document.querySelectorAll(".cart-item");

        cartItems.forEach((item) => {
          const price = parseFloat(item.getAttribute("data-price"));
          const quantity = parseInt(
            item.querySelector(".item-qty").textContent
          );
          total += price * quantity;
        });

        const formattedTotal = total.toLocaleString("tr-TR", {
          style: "currency",
          currency: "TRY",
        });

        document.getElementById(
          "cart-total"
        ).textContent = `Toplam: ${formattedTotal}`;

        // Sepet boÅŸsa UI gÃ¼ncelle
        if (cartItems.length === 0) {
          document.getElementById("cart-empty").style.display = "block";
          document.getElementById("cart-total").style.display = "none";
          document.getElementById("checkout-btn").style.display = "none";
        } else {
          document.getElementById("cart-empty").style.display = "none";
          document.getElementById("cart-total").style.display = "block";
          document.getElementById("checkout-btn").style.display = "block";
        }
      }

      window.addEventListener("DOMContentLoaded", () => {
        // Tema ayarÄ±nÄ± yÃ¼kle
        const savedTheme = localStorage.getItem("theme") || "light";
        if (savedTheme === "dark") document.body.classList.add("dark");
        updateFooterLogo();
        updateLogo(savedTheme);

        // NAV rozetini ilk yÃ¼klemede Ã§iz
        updateCartCount();

        // Sepet verisini localStorage'dan al
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        const cartItemsContainer = document.getElementById("cart-items");

        if (cart.length === 0) {
          document.getElementById("cart-empty").style.display = "block";
          document.getElementById("cart-total").style.display = "none";
          document.getElementById("checkout-btn").style.display = "none";
        } else {
          // Sepetteki Ã¼rÃ¼nleri HTML'e ekle
          cart.forEach((item) => {
            const cartItemHTML = `
          <div class="cart-item" data-id="${item.id}" data-price="${
              item.price
            }">
            <img src="${item.image}" alt="${item.name}" />
            <div class="cart-item-info">
              <div class="cart-item-title">${item.name}</div>
              <div class="cart-item-price">${item.price.toLocaleString(
                "tr-TR",
                { style: "currency", currency: "TRY" }
              )}</div>
              <div class="cart-item-quantity">
                <button class="qty-btn decrease">-</button>
                <span class="item-qty">${item.quantity}</span>
                <button class="qty-btn increase">+</button>
              </div>
            </div>
            <button class="cart-item-remove">Sil</button>
          </div>
        `;
            cartItemsContainer.insertAdjacentHTML("beforeend", cartItemHTML);
          });
          updateCartTotal();
        }

        // Adet arttÄ±r
        document.querySelectorAll(".increase").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            const itemElement = e.target.closest(".cart-item");
            const itemId = itemElement.getAttribute("data-id");
            const qtySpan = e.target.previousElementSibling;
            const newQty = parseInt(qtySpan.textContent) + 1;
            qtySpan.textContent = newQty;

            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            const itemIndex = cart.findIndex((item) => item.id === itemId);
            if (itemIndex !== -1) {
              cart[itemIndex].quantity = newQty;
              localStorage.setItem("cart", JSON.stringify(cart)); 
            }

            updateCartTotal();
          });
        });

        // Adet azalt
        document.querySelectorAll(".decrease").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            const itemElement = e.target.closest(".cart-item");
            const itemId = itemElement.getAttribute("data-id");
            const qtySpan = e.target.nextElementSibling;
            const currentQty = parseInt(qtySpan.textContent);

            if (currentQty > 1) {
              const newQty = currentQty - 1;
              qtySpan.textContent = newQty;

              const cart = JSON.parse(localStorage.getItem("cart")) || [];
              const itemIndex = cart.findIndex((item) => item.id === itemId);
              if (itemIndex !== -1) {
                cart[itemIndex].quantity = newQty;
                localStorage.setItem("cart", JSON.stringify(cart)); 
              }

              updateCartTotal();
            }
          });
        });

        // ÃœrÃ¼n sil
        document.querySelectorAll(".cart-item-remove").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            const itemElement = e.target.closest(".cart-item");
            const itemId = itemElement.getAttribute("data-id");

            itemElement.remove();

            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            const updatedCart = cart.filter((item) => item.id !== itemId);
            localStorage.setItem("cart", JSON.stringify(updatedCart)); 

            updateCartTotal();
          });
        });

        // Ã–deme sayfasÄ±na yÃ¶nlendir
        document
          .getElementById("checkout-btn")
          ?.addEventListener("click", () => {
            window.location.href = "checkout.html";
          });
      });

      // YÃ¼klenme ekranÄ±nÄ± kaldÄ±r
      window.addEventListener("load", () => {
        document.getElementById("loader").style.display = "none";
      });

      // NAV rozeti canlÄ± kalsÄ±n
      window.addEventListener("cart-changed", updateCartCount);
    </script>
  </body>
</html>
