<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TikSepet | KayÄ±t Ol</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="icon" type="image/x-icon" href="assets/favicon/favicon.ico" />
  </head>

  <body>
    <!-- Loader -->
    <div id="loader">YÃ¼kleniyor...</div>

    <!-- Navbar -->
    <header>
      <nav class="navbar">
        <a href="index.html" class="logo">
          <img
            src="assets/images/logos/logo_light.png"
            alt="TikSepet"
            id="site-logo"
          />
        </a>

        <ul class="nav-links" id="navLinks">
          <li><a href="index.html">Anasayfa</a></li>
          <li><a href="products.html">ÃœrÃ¼nler</a></li>
          <li>
            <a href="cart.html">
              Sepet <span id="cart-count" class="cart-count">0</span>
            </a>
          </li>
          <li><a href="profile.html">Profil</a></li>
          <li><a href="admin.html">Admin</a></li>
          <li id="auth-area"></li>
        </ul>

        <div class="nav-right">
          <button class="theme-toggle" onclick="toggleTheme()">ðŸŒ“</button>
          <div class="nav-toggle" onclick="toggleMenu()">
            <span></span><span></span><span></span>
          </div>
        </div>
      </nav>
    </header>

    <!-- Content -->
    <main>
      <div class="register-container">
        <h1>KayÄ±t Ol</h1>
        <form id="register-form" novalidate>
          <label for="name">Ad Soyad</label>
          <input
            type="text"
            id="name"
            placeholder="AdÄ±nÄ±z SoyadÄ±nÄ±z"
            required
          />

          <label for="email">E-posta</label>
          <input
            type="email"
            id="email"
            placeholder="ornek@mail.com"
            required
          />

          <label for="password">Åžifre</label>
          <input
            type="password"
            id="password"
            placeholder="En az 6 karakter"
            minlength="6"
            required
          />

          <label for="password2">Åžifre (Tekrar)</label>
          <input
            type="password"
            id="password2"
            placeholder="Åžifrenizi tekrar girin"
            minlength="6"
            required
          />

          <small id="form-hint"
            >Kaydolduktan sonra otomatik giriÅŸ yapÄ±lacak.</small
          >

          <button type="submit">Hesap OluÅŸtur</button>
          <p>Zaten hesabÄ±n var mÄ±? <a href="login.html">GiriÅŸ Yap</a></p>
        </form>
      </div>
    </main>

    <!-- Footer -->
    <footer>
      <div class="footer-content">
        <img
          src="assets/images/logos/logo_light.png"
          alt="TikSepet Logo"
          id="footer-logo"
          class="footer-logo"
        />
        <p>&copy; 2025 TikSepet E-Ticaret Sitesi created by Hakan Onay</p>
      </div>
    </footer>

    <script>
      // Loader kapat
      window.addEventListener("load", () => {
        const l = document.getElementById("loader");
        if (l) l.style.display = "none";
      });

      // Tema / menÃ¼ / logo
      function toggleTheme() {
        document.body.classList.toggle("dark");
        const theme = document.body.classList.contains("dark")
          ? "dark"
          : "light";
        localStorage.setItem("theme", theme);
        updateLogo(theme);
        updateFooterLogo();
      }
      function toggleMenu() {
        document.getElementById("navLinks").classList.toggle("active");
      }
      function updateLogo(theme) {
        const logo = document.getElementById("site-logo");
        if (logo)
          logo.src =
            theme === "dark"
              ? "assets/images/logos/logo_dark.png"
              : "assets/images/logos/logo_light.png";
      }
      function updateFooterLogo() {
        const logo = document.getElementById("footer-logo");
        if (logo)
          logo.src = document.body.classList.contains("dark")
            ? "assets/images/logos/logo_dark.png"
            : "assets/images/logos/logo_light.png";
      }

      // Sepet rozeti
      function updateCartCount() {
        const cart = JSON.parse(localStorage.getItem("cart") || "[]");
        const el = document.getElementById("cart-count");
        if (el) el.textContent = cart.length;
      }
      (function () {
        // canlÄ± rozet
        const _set = localStorage.setItem,
          _rem = localStorage.removeItem;
        localStorage.setItem = function (k, v) {
          const o = localStorage.getItem(k);
          _set.apply(this, arguments);
          if (k === "cart" && o !== v)
            window.dispatchEvent(new Event("cart-changed"));
        };
        localStorage.removeItem = function (k) {
          _rem.apply(this, arguments);
          if (k === "cart") window.dispatchEvent(new Event("cart-changed"));
        };
        window.addEventListener("storage", (e) => {
          if (e.key === "cart") window.dispatchEvent(new Event("cart-changed"));
        });
      })();
      window.addEventListener("cart-changed", updateCartCount);

      // Ä°lk yÃ¼klemede tema + rozet
      document.addEventListener("DOMContentLoaded", () => {
        const savedTheme = localStorage.getItem("theme") || "light";
        if (savedTheme === "dark") document.body.classList.add("dark");
        updateLogo(savedTheme);
        updateFooterLogo();
        updateCartCount();
      });

      // ------ KayÄ±t iÅŸlemi (localStorage: users, currentUserId) ------
      function getUsers() {
        try {
          return JSON.parse(localStorage.getItem("users") || "[]");
        } catch {
          return [];
        }
      }
      function setUsers(arr) {
        localStorage.setItem("users", JSON.stringify(arr));
      }

      document
        .getElementById("register-form")
        .addEventListener("submit", (e) => {
          e.preventDefault();
          const name = document.getElementById("name").value.trim();
          const email = document
            .getElementById("email")
            .value.trim()
            .toLowerCase();
          const password = document.getElementById("password").value.trim();
          const password2 = document.getElementById("password2").value.trim();

          if (!name || !email || !password || !password2) {
            alert("LÃ¼tfen tÃ¼m alanlarÄ± doldurun.");
            return;
          }
          if (password.length < 6) {
            alert("Åžifre en az 6 karakter olmalÄ±.");
            return;
          }
          if (password !== password2) {
            alert("Åžifreler eÅŸleÅŸmiyor.");
            return;
          }

          let users = getUsers();
          const exists = users.some((u) => u.email === email);
          if (exists) {
            alert("Bu e-posta ile zaten bir hesap var.");
            return;
          }

          const newUser = {
            id: Date.now(),
            name,
            email,
            password, // demo amaÃ§lÄ± dÃ¼z metin (ileride hash'leyeceÄŸiz)
          };
          users.push(newUser);
          setUsers(users);
          localStorage.setItem("currentUserId", String(newUser.id)); // otomatik giriÅŸ

          // varsa return param'Ä±na dÃ¶n
          const params = new URLSearchParams(location.search);
          const ret = params.get("return");
          location.href = ret ? decodeURIComponent(ret) : "index.html";
        });
    </script>

    <!-- Auth helper (navbar'da HoÅŸ geldin/Ã‡Ä±kÄ±ÅŸ gÃ¶stermek istersen) -->
    <script src="js/auth.js"></script>
  </body>
</html>
