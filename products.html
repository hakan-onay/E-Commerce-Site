<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TikSepet | ÃœrÃ¼nler</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="icon" type="image/x-icon" href="assets/favicon/favicon.ico" />
  </head>
  <body>
    <!-- YÃ¼kleniyor gÃ¶stergesi -->
    <div id="loader">YÃ¼kleniyor...</div>

    <!-- Ãœst navigasyon -->
    <header>
      <nav class="navbar">
        <a href="index.html" class="logo">
          <img
            src="assets/images/logos/logo_light.png"
            alt="TikSepet"
            id="site-logo"
          />
        </a>

        <!-- MenÃ¼ baÄŸlantÄ±larÄ± -->
        <ul class="nav-links" id="navLinks">
          <li><a href="index.html">Anasayfa</a></li>
          <li><a href="products.html">ÃœrÃ¼nler</a></li>
          <li>
            <a href="cart.html">
              Sepet <span id="cart-count" class="cart-count">0</span>
            </a>
          </li>
          <li><a href="profile.html">Profil</a></li>
          <li><a href="admin.html">Admin</a></li>
          <li id="auth-area"></li>
        </ul>

        <!-- Tema ve hamburger birlikte -->
        <div class="nav-right">
          <button class="theme-toggle" onclick="toggleTheme()">ðŸŒ“</button>
          <div class="nav-toggle" onclick="toggleMenu()">
            <span></span><span></span><span></span>
          </div>
        </div>
      </nav>
    </header>

    <!-- Ana iÃ§erik alanÄ± -->
    <main>
      <section class="product-list">
        <h1>ÃœrÃ¼nler</h1>

        <!-- Filtreleme Ã§ubuÄŸu -->
        <div class="filter-bar">
          <input type="text" placeholder="ÃœrÃ¼n ara..." class="search-input" />
          <select class="category-filter">
            <option value="all">TÃ¼m Kategoriler</option>
            <option value="elektronik">Elektronik</option>
            <option value="giyim">Giyim</option>
            <option value="aksesuar">Aksesuar</option>
          </select>
        </div>

        <!-- ÃœrÃ¼n gridi -->
        <div class="product-grid">
          <!-- ÃœrÃ¼n kartÄ± 1 -->
          <div class="product-card" data-category="elektronik">
            <img src="assets/images/products/product1.jpg" alt="AkÄ±llÄ± Saat" />
            <h3>AkÄ±llÄ± Saat</h3>
            <p class="price">â‚º21.499,00</p>
            <div class="rating">
              <span class="star">&#9733;</span>
              <span class="star">&#9733;</span>
              <span class="star">&#9733;</span>
              <span class="star">&#9734;</span>
              <span class="star">&#9734;</span>
            </div>
            <button
              class="btn add-to-cart"
              data-id="1"
              data-name="AkÄ±llÄ± Saat"
              data-price="21499.00"
              data-image="assets/images/products/product1.jpg"
            >
              Sepete Ekle
            </button>
          </div>

          <!-- ÃœrÃ¼n kartÄ± 2 -->
          <div class="product-card" data-category="elektronik">
            <img src="assets/images/products/product2.jpg" alt="KulaklÄ±k" />
            <h3>KulaklÄ±k</h3>
            <p class="price">â‚º29.999,00</p>
            <div class="rating">
              <span class="star">&#9733;</span>
              <span class="star">&#9733;</span>
              <span class="star">&#9733;</span>
              <span class="star">&#9733;</span>
              <span class="star">&#9734;</span>
            </div>
            <button
              class="btn add-to-cart"
              data-id="2"
              data-name="KulaklÄ±k"
              data-price="29999.00"
              data-image="assets/images/products/product2.jpg"
            >
              Sepete Ekle
            </button>
          </div>

          <!-- ÃœrÃ¼n kartÄ± 3 -->
          <div class="product-card" data-category="elektronik">
            <img
              src="assets/images/products/product3.jpg"
              alt="Bluetooth HoparlÃ¶r"
            />
            <h3>Bluetooth HoparlÃ¶r</h3>
            <p class="price">â‚º16.659,02</p>
            <div class="rating">
              <span class="star">&#9733;</span>
              <span class="star">&#9733;</span>
              <span class="star">&#9734;</span>
              <span class="star">&#9734;</span>
              <span class="star">&#9734;</span>
            </div>
            <button
              class="btn add-to-cart"
              data-id="3"
              data-name="Bluetooth HoparlÃ¶r"
              data-price="16659.02"
              data-image="assets/images/products/product3.jpg"
            >
              Sepete Ekle
            </button>
          </div>
        </div>
      </section>
    </main>

    <!-- Sayfa altbilgisi -->
    <footer>
      <div class="footer-content">
        <img
          src="assets/images/logos/logo_light.png"
          alt="TikSepet Logo"
          id="footer-logo"
          class="footer-logo"
        />
        <p>&copy; 2025 TikSepet E-Ticaret Sitesi created by Hakan Onay</p>
      </div>
    </footer>

    <!-- JavaScript -->
    <script>
      // Footer logosunu gÃ¼ncelle
      function updateFooterLogo() {
        const footerLogo = document.getElementById("footer-logo");
        footerLogo.src = document.body.classList.contains("dark")
          ? "assets/images/logos/logo_dark.png"
          : "assets/images/logos/logo_light.png";
      }

      // Mobil menÃ¼yÃ¼ aÃ§/kapat
      function toggleMenu() {
        document.getElementById("navLinks").classList.toggle("active");
      }

      // Tema deÄŸiÅŸtirme
      function toggleTheme() {
        document.body.classList.toggle("dark");
        const theme = document.body.classList.contains("dark")
          ? "dark"
          : "light";
        localStorage.setItem("theme", theme);
        updateFooterLogo();
        updateLogo(theme);
      }

      // Logo gÃ¼ncelle
      function updateLogo(theme) {
        const logo = document.getElementById("site-logo");
        logo.src =
          theme === "dark"
            ? "assets/images/logos/logo_dark.png"
            : "assets/images/logos/logo_light.png";
      }

      // Sayfa yÃ¼klendiÄŸinde temayÄ± uygula
      window.addEventListener("DOMContentLoaded", () => {
        const savedTheme = localStorage.getItem("theme") || "light";
        if (savedTheme === "dark") document.body.classList.add("dark");
        updateFooterLogo();
        updateLogo(savedTheme);
      });

      // YÃ¼kleme ekranÄ±nÄ± kapat
      window.addEventListener("load", () => {
        document.getElementById("loader").style.display = "none";
      });

      // ÃœrÃ¼n rating etkileÅŸimi
      document.addEventListener("DOMContentLoaded", () => {
        const stars = document.querySelectorAll(".star");
        stars.forEach((star) => {
          star.addEventListener("click", function () {
            const productCard = this.closest(".product-card");
            const ratingContainer = productCard.querySelector(".rating");
            const stars = ratingContainer.querySelectorAll(".star");
            const clickedIndex = Array.from(stars).indexOf(this);
            stars.forEach((s, index) => {
              if (index <= clickedIndex) s.classList.add("selected");
              else s.classList.remove("selected");
            });
          });
        });
      });

      // TÃ¼m "Sepete Ekle" butonlarÄ± (AUTH GUARD + ekleme)
      const addToCartButtons = document.querySelectorAll(".add-to-cart");
      addToCartButtons.forEach((button) => {
        button.addEventListener("click", () => {
          // GiriÅŸ kontrolÃ¼
          if (!localStorage.getItem("currentUserId")) {
            const ret = encodeURIComponent(location.pathname);
            location.href = `login.html?return=${ret}`;
            return;
          }

          // ÃœrÃ¼n bilgileri
          const id = button.getAttribute("data-id");
          const name = button.getAttribute("data-name");
          const price = parseFloat(button.getAttribute("data-price"));
          const image = button.getAttribute("data-image");

          let cart = JSON.parse(localStorage.getItem("cart")) || [];
          const existingItem = cart.find((item) => item.id === id);
          if (existingItem) existingItem.quantity += 1;
          else cart.push({ id, name, price, image, quantity: 1 });

          localStorage.setItem("cart", JSON.stringify(cart)); // -> cart-changed tetikler
          showToast(`${name} sepete eklendi.`);
        });
      });

      // ÃœrÃ¼n filtreleme (arama + kategori)
      document.addEventListener("DOMContentLoaded", () => {
        const searchInput = document.querySelector(".search-input");
        const categorySelect = document.querySelector(".category-filter");
        const productCards = document.querySelectorAll(".product-card");

        function filterProducts() {
          const searchText = searchInput.value.toLowerCase();
          const selectedCategory = categorySelect.value;

          productCards.forEach((card) => {
            const productName = card
              .querySelector("h3")
              .textContent.toLowerCase();
            const category = card.getAttribute("data-category") || "all";

            const matchesSearch = productName.includes(searchText);
            const matchesCategory =
              selectedCategory === "all" || selectedCategory === category;

            card.style.display =
              matchesSearch && matchesCategory ? "block" : "none";
          });
        }

        searchInput.addEventListener("input", filterProducts);
        categorySelect.addEventListener("change", filterProducts);
      });

      // Toast mesajÄ±
      function showToast(message) {
        const container = document.getElementById("toast-container");
        const toast = document.createElement("div");
        toast.className = "toast";
        toast.textContent = message;
        container.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
      }

      // Sepet rozeti
      function updateCartCount() {
        const cart = JSON.parse(localStorage.getItem("cart") || "[]");
        const cartCountElement = document.getElementById("cart-count");
        if (cartCountElement) cartCountElement.textContent = cart.length;
      }

      // CanlÄ± rozet: localStorage deÄŸiÅŸimini yakalar
      (function () {
        const _setItem = localStorage.setItem;
        const _removeItem = localStorage.removeItem;
        localStorage.setItem = function (key, value) {
          const oldVal = localStorage.getItem(key);
          _setItem.apply(this, arguments);
          if (key === "cart" && oldVal !== value) {
            window.dispatchEvent(new Event("cart-changed"));
          }
        };
        localStorage.removeItem = function (key) {
          _removeItem.apply(this, arguments);
          if (key === "cart") {
            window.dispatchEvent(new Event("cart-changed"));
          }
        };
        window.addEventListener("storage", (e) => {
          if (e.key === "cart") window.dispatchEvent(new Event("cart-changed"));
        });
      })();

      // Ä°lk yÃ¼klemede Ã§iz + canlÄ± tut
      document.addEventListener("DOMContentLoaded", updateCartCount);
      window.addEventListener("cart-changed", updateCartCount);
    </script>

    <!-- Toast bildirimi -->
    <div id="toast-container"></div>

    <!-- Auth -->
    <script src="js/auth.js"></script>
  </body>
</html>
